<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Universal de Equa√ß√µes Qu√≠micas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    <style>
        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary: #f8fafc;
            --accent: #3b82f6;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --text: #1e293b;
            --border: #e2e8f0;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --glow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--primary);
            min-height: 100vh;
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }

        .hero {
            text-align: center;
            padding: 40px 15px;
            color: white;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="white" opacity="0.1"/><circle cx="80" cy="40" r="1" fill="white" opacity="0.1"/><circle cx="40" cy="80" r="1.5" fill="white" opacity="0.1"/><circle cx="60" cy="10" r="1" fill="white" opacity="0.1"/><circle cx="90" cy="80" r="2" fill="white" opacity="0.1"/></svg>');
            animation: float 20s infinite linear;
        }

        @keyframes float {
            from { transform: translateY(0px) rotate(0deg); }
            to { transform: translateY(-20px) rotate(360deg); }
        }

        h1 {
            font-size: clamp(1.8rem, 5vw, 3.5rem);
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .main-calculator {
            background: white;
            border-radius: 20px;
            padding: 25px 15px;
            margin: 20px 0;
            box-shadow: var(--shadow);
            position: relative;
            backdrop-filter: blur(20px);
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .input-section {
            margin-bottom: 25px;
        }

        .input-label {
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            font-weight: 700;
            margin-bottom: 12px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .equation-input {
            width: 100%;
            padding: 18px 15px;
            border: 3px solid var(--border);
            border-radius: 15px;
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 600;
        }

        .equation-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: var(--glow);
            transform: translateY(-2px);
        }

        .tutorial-section {
            background: linear-gradient(135deg, #e0f2fe, #dbeafe);
            border: 2px solid #3b82f6;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            animation: slideDown 0.6s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; max-height: 0; }
            to { opacity: 1; max-height: 500px; }
        }

        .tutorial-title {
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tutorial-content {
            font-size: clamp(0.85rem, 2.5vw, 1rem);
            color: #1e293b;
            line-height: 1.8;
        }

        .tutorial-example {
            background: white;
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #3b82f6;
            border-left: 4px solid #3b82f6;
            font-size: clamp(0.8rem, 2.5vw, 0.95rem);
        }

        .controls {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 14px 25px;
            border: none;
            border-radius: 12px;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            flex: 1;
            min-width: 140px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
            transform: translateY(-3px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b, #475569);
            color: white;
            box-shadow: 0 6px 20px rgba(100, 116, 139, 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px 15px;
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border-radius: 15px;
            margin: 20px 0;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-container {
            display: none;
            margin: 25px 0;
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-card {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 3px solid var(--success);
            border-radius: 20px;
            padding: 25px 15px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.05) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .result-title {
            font-size: clamp(1.1rem, 3vw, 1.6rem);
            font-weight: 800;
            color: var(--success);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        .balanced-equation {
            font-family: 'Courier New', monospace;
            font-size: clamp(1rem, 3.5vw, 1.8rem);
            font-weight: 800;
            background: white;
            padding: 20px 15px;
            border-radius: 12px;
            margin: 15px 0;
            border: 2px solid var(--border);
            text-align: center;
            position: relative;
            z-index: 1;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .coefficients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }

        .coefficient-item {
            background: white;
            padding: 15px 10px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
            animation: popIn 0.4s ease backwards;
        }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .coefficient-item:nth-child(1) { animation-delay: 0.1s; }
        .coefficient-item:nth-child(2) { animation-delay: 0.2s; }
        .coefficient-item:nth-child(3) { animation-delay: 0.3s; }
        .coefficient-item:nth-child(4) { animation-delay: 0.4s; }

        .coefficient-item:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .coefficient-compound {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: clamp(0.95rem, 3vw, 1.3rem);
            color: var(--accent);
            word-break: break-word;
        }

        .coefficient-value {
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 800;
            color: var(--success);
            margin-top: 8px;
        }

        .error-card {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 3px solid var(--error);
            color: var(--error);
        }

        .error-title {
            color: var(--error);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .main-calculator {
                padding: 20px 12px;
                border-radius: 15px;
            }

            .hero {
                padding: 30px 10px;
            }
            
            .controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
                min-width: unset;
                padding: 16px 20px;
            }

            .coefficients-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .balanced-equation {
                font-size: clamp(0.85rem, 4vw, 1.2rem);
                padding: 15px 10px;
            }

            .tutorial-section {
                padding: 15px;
            }

            .tutorial-example {
                padding: 10px;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .coefficient-value {
                font-size: 1.5rem;
            }

            .coefficient-compound {
                font-size: 0.9rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .subtitle {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="hero">
            <h1>‚öóÔ∏è Calculadora de Equa√ß√µes Qu√≠micas</h1>
            <p class="subtitle">Balanceamento autom√°tico e inteligente</p>
        </div>

        <div class="main-calculator">
            <div class="input-section">
                <div class="input-label">
                    üß™ Escreva sua Equa√ß√£o
                </div>
                <input type="text" 
                       id="equation" 
                       class="equation-input" 
                       placeholder="CH4 + O2 ‚Üí CO2 + H2O"
                       autocomplete="off">
            </div>

                <div class="controls">
                <button class="btn btn-primary" onclick="balanceEquation()">
                    üßÆ Balancear
                </button>
                <button class="btn btn-secondary" onclick="clearAll()">
                    üóëÔ∏è Limpar
                </button>
            </div>

                <div class="loading" id="loading">
                <div class="spinner"></div>
                <p><strong>Processando equa√ß√£o...</strong></p>
            </div>
            
            <div id="result" class="result-container">
                <div id="resultCard" class="result-card">
                    <div class="result-title" id="resultTitle">
                        ‚úÖ Equa√ß√£o balanceada!
                    </div>
                    <div id="balancedEquation" class="balanced-equation"></div>
                    <div id="coefficientsDisplay" class="coefficients-grid"></div>
                </div>
            </div>
        </div>
    </div>


            <div class="tutorial-section">
                <div class="tutorial-title">
                    üìñ Como usar - Formatos aceitos
                </div>
                <div class="tutorial-content">
                    <strong>‚úÖ Equa√ß√£o Completa:</strong>
                    <div class="tutorial-example">CH4 + O2 ‚Üí CO2 + H2O</div>
                    <div class="tutorial-example">C8H18 + O2 = CO2 + H2O</div>
                    <div class="tutorial-example">Fe + O2 -> Fe2O3</div>
                    
                    <strong>‚úÖ Apenas Reagentes (Auto-completa):</strong>
                    <div class="tutorial-example">H2 + O2</div>
                    <div class="tutorial-example">N2 + H2</div>
                    <div class="tutorial-example">CH4 + O2</div>
                    
                    <strong>üí° Dicas:</strong><br>
                    ‚Ä¢ Use <strong>‚Üí</strong>, <strong>=</strong> ou <strong>-></strong> para separar reagentes dos produtos<br>
                    ‚Ä¢ Use <strong>+</strong> para separar compostos<br>
                    ‚Ä¢ Escreva elementos com mai√∫sculas: <strong>H2O</strong>, n√£o h2o<br>
                    ‚Ä¢ N√∫meros ap√≥s elementos indicam quantidade: H<strong>2</strong>O, CO<strong>2</strong>
                </div>
            </div>
            
            

            

    <script>
        class ChemicalBalancer {
            constructor() {
                this.periodicTable = this.initializePeriodicTable();
                this.reactionRules = this.initializeReactionRules();
                this.processedCount = 0;
                this.successCount = 0;
            }

            initializePeriodicTable() {
                return {
                    'H': 1.008, 'He': 4.003, 'Li': 6.94, 'Be': 9.012,
                    'B': 10.81, 'C': 12.01, 'N': 14.01, 'O': 16.00,
                    'F': 19.00, 'Ne': 20.18, 'Na': 22.99, 'Mg': 24.31,
                    'Al': 26.98, 'Si': 28.09, 'P': 30.97, 'S': 32.07,
                    'Cl': 35.45, 'Ar': 39.95, 'K': 39.10, 'Ca': 40.08,
                    'Sc': 44.96, 'Ti': 47.87, 'V': 50.94, 'Cr': 52.00,
                    'Mn': 54.94, 'Fe': 55.85, 'Co': 58.93, 'Ni': 58.69,
                    'Cu': 63.55, 'Zn': 65.38, 'Ga': 69.72, 'Ge': 72.63,
                    'As': 74.92, 'Se': 78.97, 'Br': 79.90, 'Kr': 83.80,
                    'Rb': 85.47, 'Sr': 87.62, 'Y': 88.91, 'Zr': 91.22,
                    'Nb': 92.91, 'Mo': 95.95, 'Tc': 97.91, 'Ru': 101.07,
                    'Rh': 102.91, 'Pd': 106.42, 'Ag': 107.87, 'Cd': 112.41,
                    'In': 114.82, 'Sn': 118.71, 'Sb': 121.76, 'Te': 127.60,
                    'I': 126.90, 'Xe': 131.29, 'Cs': 132.91, 'Ba': 137.33,
                    'La': 138.91, 'Ce': 140.12, 'Pr': 140.91, 'Nd': 144.24,
                    'Pm': 144.91, 'Sm': 150.36, 'Eu': 151.96, 'Gd': 157.25,
                    'Tb': 158.93, 'Dy': 162.50, 'Ho': 164.93, 'Er': 167.26,
                    'Tm': 168.93, 'Yb': 173.05, 'Lu': 174.97, 'Hf': 178.49,
                    'Ta': 180.95, 'W': 183.84, 'Re': 186.21, 'Os': 190.23,
                    'Ir': 192.22, 'Pt': 195.08, 'Au': 196.97, 'Hg': 200.59,
                    'Tl': 204.38, 'Pb': 207.2, 'Bi': 208.98, 'Po': 208.98,
                    'At': 209.99, 'Rn': 222.02, 'Fr': 223.02, 'Ra': 226.03,
                    'Ac': 227.03, 'Th': 232.04, 'Pa': 231.04, 'U': 238.03
                };
            }

            initializeReactionRules() {
                return {
                    metals: ['Na', 'K', 'Ca', 'Mg', 'Al', 'Fe', 'Cu', 'Zn', 'Ag', 'Li', 'Ba', 'Sr'],
                    nonmetals: ['O', 'Cl', 'Br', 'I', 'F', 'S', 'N'],
                    valences: {
                        'Na': 1, 'K': 1, 'Li': 1, 'Ag': 1,
                        'Ca': 2, 'Mg': 2, 'Ba': 2, 'Sr': 2, 'Zn': 2,
                        'Al': 3, 'Fe': 3,
                        'O': -2, 'S': -2,
                        'Cl': -1, 'Br': -1, 'I': -1, 'F': -1,
                        'N': -3
                    }
                };
            }

            detectReactionType(reactants) {
                if (reactants.length === 1) return 'decomposition';
                
                if (reactants.length === 2) {
                    const hasOrganic = reactants.some(r => this.isOrganic(r));
                    const hasO2 = reactants.some(r => r === 'O2' || r === 'O');
                    
                    if (hasOrganic && hasO2) return 'combustion';
                    
                    const hasAcid = reactants.some(r => this.isAcid(r));
                    const hasBase = reactants.some(r => this.isBase(r));
                    
                    if (hasAcid && hasBase) return 'neutralization';
                    
                    const hasMetal = reactants.some(r => this.isMetal(r));
                    const hasNonmetal = reactants.some(r => this.isNonmetal(r));
                    
                    if (hasMetal && hasNonmetal) return 'synthesis';
                    if (reactants.every(r => this.isPureElement(r))) return 'synthesis';
                    
                    return 'double_displacement';
                }
                
                return 'unknown';
            }

            isOrganic(compound) {
                return /C\d*H/.test(compound);
            }

            isAcid(compound) {
                return compound.startsWith('H') && (compound.includes('Cl') || compound.includes('NO3') || compound.includes('SO4'));
            }

            isBase(compound) {
                return compound.includes('OH');
            }

            isMetal(element) {
                return this.reactionRules.metals.some(m => element.startsWith(m));
            }

            isNonmetal(element) {
                return this.reactionRules.nonmetals.some(nm => element.includes(nm));
            }

            isPureElement(compound) {
                return compound.match(/^([A-Z][a-z]?)(\d*)$/) !== null;
            }

            predictProducts(reactants) {
                const reactionType = this.detectReactionType(reactants);
                
                switch (reactionType) {
                    case 'synthesis': return this.predictSynthesis(reactants);
                    case 'combustion': return this.predictCombustion(reactants);
                    case 'decomposition': return this.predictDecomposition(reactants[0]);
                    case 'neutralization': return this.predictNeutralization(reactants);
                    case 'double_displacement': return this.predictDoubleDisplacement(reactants);
                    default: throw new Error('Tipo de rea√ß√£o n√£o identificado');
                }
            }

            predictSynthesis(reactants) {
                if (reactants.length !== 2) throw new Error('S√≠ntese requer 2 reagentes');
                
                const r1 = reactants[0].replace(/\d+$/, '');
                const r2 = reactants[1].replace(/\d+$/, '');
                
                if ((r1 === 'H' || r1 === 'H2') && (r2 === 'O' || r2 === 'O2')) return ['H2O'];
                if ((r1 === 'N' || r1 === 'N2') && (r2 === 'H' || r2 === 'H2')) return ['NH3'];
                if ((r1 === 'C') && (r2 === 'O' || r2 === 'O2')) return ['CO2'];
                
                const metal = this.reactionRules.metals.find(m => r1.startsWith(m) || r2.startsWith(m));
                
                if (metal && (r1.includes('O') || r2.includes('O'))) {
                    const valence = this.reactionRules.valences[metal] || 2;
                    if (valence === 1) return [`${metal}2O`];
                    if (valence === 2) return [`${metal}O`];
                    if (valence === 3) return [`${metal}2O3`];
                }
                
                if (metal && (r1.includes('Cl') || r2.includes('Cl'))) {
                    const valence = this.reactionRules.valences[metal] || 2;
                    if (valence === 1) return [`${metal}Cl`];
                    if (valence === 2) return [`${metal}Cl2`];
                    if (valence === 3) return [`${metal}Cl3`];
                }
                
                throw new Error('N√£o foi poss√≠vel prever os produtos');
            }

            predictCombustion(reactants) {
                const organic = reactants.find(r => this.isOrganic(r));
                if (!organic) throw new Error('Combust√£o requer um composto org√¢nico');
                return ['CO2', 'H2O'];
            }

            predictDecomposition(compound) {
                if (compound === 'H2O') return ['H2', 'O2'];
                if (compound === 'H2O2') return ['H2O', 'O2'];
                
                const composition = this.parseCompound(compound);
                if (composition['O']) {
                    const elements = Object.keys(composition).filter(e => e !== 'O');
                    if (elements.length === 1) return [elements[0], 'O2'];
                }
                
                throw new Error('N√£o foi poss√≠vel prever os produtos');
            }

            predictNeutralization(reactants) {
                return ['Sal', 'H2O'];
            }

            predictDoubleDisplacement(reactants) {
                throw new Error('Dupla troca requer informa√ß√£o adicional');
            }

            completeEquation(input) {
                if (!input.includes('‚Üí') && !input.includes('->') && !input.includes('=')) {
                    const reactants = input.split('+').map(r => r.trim()).filter(r => r);
                    if (reactants.length === 0) throw new Error('Digite pelo menos um reagente');
                    
                    const products = this.predictProducts(reactants);
                    const completeEq = `${reactants.join(' + ')} ‚Üí ${products.join(' + ')}`;
                    
                    return {
                        completed: true,
                        equation: completeEq,
                        reactionType: this.detectReactionType(reactants)
                    };
                }
                
                return { completed: false, equation: input };
            }

            parseCompound(formula) {
                const elements = {};
                const regex = /([A-Z][a-z]?)(\d*)/g;
                let match;

                const cleanFormula = formula.replace(/\s/g, '');

                while ((match = regex.exec(cleanFormula)) !== null) {
                    const element = match[1];
                    const count = parseInt(match[2]) || 1;
                    
                    if (!this.periodicTable[element]) {
                        throw new Error(`Elemento desconhecido: ${element}`);
                    }
                    
                    elements[element] = (elements[element] || 0) + count;
                }

                return elements;
            }

            parseEquation(equation) {
                const normalized = equation.replace(/\s+/g, ' ').replace(/=/g, '‚Üí').replace(/->/g, '‚Üí').trim();
                const parts = normalized.split('‚Üí');
                
                if (parts.length !== 2) {
                    throw new Error('Equa√ß√£o deve ter reagentes e produtos separados por ‚Üí');
                }

                const reactants = parts[0].split('+').map(r => r.trim()).filter(r => r);
                const products = parts[1].split('+').map(p => p.trim()).filter(p => p);

                if (reactants.length === 0 || products.length === 0) {
                    throw new Error('Equa√ß√£o deve ter pelo menos um reagente e um produto');
                }

                return { reactants, products };
            }

            getAllElements(reactants, products) {
                const elements = new Set();
                const allCompounds = [...reactants, ...products];
                
                for (const compound of allCompounds) {
                    const compoundElements = this.parseCompound(compound);
                    Object.keys(compoundElements).forEach(element => elements.add(element));
                }
                
                return Array.from(elements);
            }

            buildMatrix(reactants, products, elements) {
                const matrix = [];
                
                for (const element of elements) {
                    const row = [];
                    
                    for (const compound of reactants) {
                        const composition = this.parseCompound(compound);
                        row.push(-(composition[element] || 0));
                    }
                    
                    for (const compound of products) {
                        const composition = this.parseCompound(compound);
                        row.push(composition[element] || 0);
                    }
                    
                    matrix.push(row);
                }
                
                return matrix;
            }

            solveMatrix(matrix) {
                const rows = matrix.length;
                const cols = matrix[0].length;
                
                for (let i = 0; i < Math.min(rows, cols - 1); i++) {
                    let maxRow = i;
                    for (let k = i + 1; k < rows; k++) {
                        if (Math.abs(matrix[k][i]) > Math.abs(matrix[maxRow][i])) {
                            maxRow = k;
                        }
                    }
                    
                    [matrix[i], matrix[maxRow]] = [matrix[maxRow], matrix[i]];
                    
                    for (let k = i + 1; k < rows; k++) {
                        if (Math.abs(matrix[i][i]) > 1e-10) {
                            const c = matrix[k][i] / matrix[i][i];
                            for (let j = i; j < cols; j++) {
                                matrix[k][j] -= c * matrix[i][j];
                            }
                        }
                    }
                }

                const solution = new Array(cols).fill(1);
                solution[cols - 1] = 1;
                
                for (let i = Math.min(rows, cols - 1) - 1; i >= 0; i--) {
                    if (Math.abs(matrix[i][i]) > 1e-10) {
                        let sum = 0;
                        for (let j = i + 1; j < cols; j++) {
                            sum += matrix[i][j] * solution[j];
                        }
                        solution[i] = -sum / matrix[i][i];
                    }
                }
                
                return this.normalizeCoefficients(solution);
            }

            normalizeCoefficients(coefficients) {
                const normalized = coefficients.map(c => Math.abs(c));
                
                let scale = 1;
                for (const coeff of normalized) {
                    if (coeff > 0) {
                        const decimal = coeff % 1;
                        if (decimal > 0.001) {
                            for (let denom = 2; denom <= 20; denom++) {
                                if (Math.abs(decimal * denom - Math.round(decimal * denom)) < 0.001) {
                                    scale = Math.max(scale, denom);
                                    break;
                                }
                            }
                        }
                    }
                }
                
                const integers = normalized.map(c => Math.round(c * scale));
                return integers.map(c => c === 0 ? 1 : c);
            }

            balance(equation) {
                try {
                    const completion = this.completeEquation(equation);
                    const equationToBalance = completion.equation;
                    
                    const { reactants, products } = this.parseEquation(equationToBalance);
                    const elements = this.getAllElements(reactants, products);
                    const matrix = this.buildMatrix(reactants, products, elements);
                    const coefficients = this.solveMatrix(matrix);
                    
                    this.verifyBalance(reactants, products, coefficients, elements);
                    
                    this.processedCount++;
                    this.successCount++;
                    
                    return {
                        success: true,
                        reactants,
                        products,
                        coefficients,
                        balanced: this.formatEquation(reactants, products, coefficients),
                        wasCompleted: completion.completed,
                        reactionType: completion.reactionType
                    };
                    
                } catch (error) {
                    this.processedCount++;
                    throw new Error(`Erro: ${error.message}`);
                }
            }

            verifyBalance(reactants, products, coefficients, elements) {
                for (const element of elements) {
                    let leftSide = 0, rightSide = 0;
                    
                    for (let i = 0; i < reactants.length; i++) {
                        const composition = this.parseCompound(reactants[i]);
                        leftSide += (composition[element] || 0) * coefficients[i];
                    }
                    
                    for (let i = 0; i < products.length; i++) {
                        const composition = this.parseCompound(products[i]);
                        rightSide += (composition[element] || 0) * coefficients[reactants.length + i];
                    }
                    
                    if (Math.abs(leftSide - rightSide) > 0.1) {
                        throw new Error(`Desbalanceamento detectado para ${element}`);
                    }
                }
            }

            formatEquation(reactants, products, coefficients) {
                const reactantStr = reactants.map((compound, i) => {
                    const coeff = coefficients[i];
                    return coeff === 1 ? compound : `${coeff} ${compound}`;
                }).join(' + ');
                
                const productStr = products.map((compound, i) => {
                    const coeff = coefficients[reactants.length + i];
                    return coeff === 1 ? compound : `${coeff} ${compound}`;
                }).join(' + ');
                
                return `${reactantStr} ‚Üí ${productStr}`;
            }
        }

        const balancer = new ChemicalBalancer();

        async function balanceEquation() {
            const input = document.getElementById('equation').value.trim();
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const resultCard = document.getElementById('resultCard');
            const resultTitle = document.getElementById('resultTitle');
            const balancedEquation = document.getElementById('balancedEquation');
            const coefficientsDisplay = document.getElementById('coefficientsDisplay');

            if (!input) {
                showError('Por favor, digite uma equa√ß√£o qu√≠mica.');
                return;
            }

            loading.style.display = 'block';
            result.style.display = 'none';

            try {
                await new Promise(resolve => setTimeout(resolve, Math.random() * 800 + 400));
                
                const balanced = balancer.balance(input);
                
                loading.style.display = 'none';
                result.style.display = 'block';
                resultCard.className = 'result-card';
                resultTitle.innerHTML = '‚úÖ Equa√ß√£o balanceada!';
                resultTitle.className = 'result-title';
                
                balancedEquation.textContent = balanced.balanced;
                
                if (balanced.wasCompleted) {
                    const typeNames = {
                        'synthesis': 'S√≠ntese',
                        'combustion': 'Combust√£o',
                        'decomposition': 'Decomposi√ß√£o',
                        'neutralization': 'Neutraliza√ß√£o',
                        'double_displacement': 'Dupla Troca'
                    };
                    
                    const infoDiv = document.createElement('div');
                    infoDiv.style.cssText = 'background: #dbeafe; border: 2px solid #3b82f6; border-radius: 10px; padding: 12px; margin: 12px 0; font-weight: 600; font-size: clamp(0.85rem, 2.5vw, 1rem);';
                    infoDiv.innerHTML = `üß™ <strong>Equa√ß√£o completada!</strong><br>Tipo: <strong>${typeNames[balanced.reactionType] || 'Desconhecido'}</strong>`;
                    balancedEquation.parentNode.insertBefore(infoDiv, balancedEquation);
                }
                
                displayCoefficients(balanced.reactants, balanced.products, balanced.coefficients);
                
            } catch (error) {
                loading.style.display = 'none';
                showError(error.message);
            }
        }

        function displayCoefficients(reactants, products, coefficients) {
            const container = document.getElementById('coefficientsDisplay');
            const allCompounds = [...reactants, ...products];
            
            container.innerHTML = allCompounds.map((compound, i) => {
                const coeff = coefficients[i];
                const type = i < reactants.length ? 'Reagente' : 'Produto';
                return `
                    <div class="coefficient-item">
                        <div class="coefficient-compound">${compound}</div>
                        <div class="coefficient-value">${coeff}</div>
                        <div style="font-size: clamp(0.75rem, 2vw, 0.9rem); color: #64748b; margin-top: 5px;">${type}</div>
                    </div>
                `;
            }).join('');
        }

        function showError(message) {
            const result = document.getElementById('result');
            const resultCard = document.getElementById('resultCard');
            const resultTitle = document.getElementById('resultTitle');
            const balancedEquation = document.getElementById('balancedEquation');
            const coefficientsDisplay = document.getElementById('coefficientsDisplay');
            
            result.style.display = 'block';
            resultCard.className = 'result-card error-card';
            resultTitle.innerHTML = '‚ùå Erro';
            resultTitle.className = 'result-title error-title';
            balancedEquation.textContent = message;
            balancedEquation.style.fontSize = 'clamp(0.9rem, 3vw, 1.2rem)';
            coefficientsDisplay.innerHTML = '';
        }

        function clearAll() {
            document.getElementById('equation').value = '';
            document.getElementById('result').style.display = 'none';
            document.getElementById('loading').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('equation').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    balanceEquation();
                }
            });

            console.log('üöÄ Calculadora de Equa√ß√µes Qu√≠micas iniciada!');
        });

        window.ChemicalBalancer = {
            balance: (eq) => balancer.balance(eq),
            getStats: () => ({
                processed: balancer.processedCount,
                success: balancer.successCount
            })
        };
    </script>
</body>
</html>